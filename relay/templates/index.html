{% extends "base.html" %}

{% block title %}ã²ã‚‰ã‚ããƒªãƒ¬ãƒ¼ - ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='dashboard.css') }}">
{% endblock %}

{% block header_intro %}
<p class="header-eyebrow">HOME</p>
<h1 class="header-title">ãƒ›ãƒ¼ãƒ </h1>
{% endblock %}

{% block content %}
<!-- Event Banner -->
{% if active_events %}
    {% set event = active_events[0] %}
    <div class="event-banner">
        <div class="event-content">
            <div class="event-status-badge">ç¾åœ¨é–‹å‚¬ä¸­</div>
            <h2>{{ event.name }}</h2>
            <!-- è©³ç´°æƒ…å ±ãŒã‚ã‚Œã°ã“ã“ã«è¡¨ç¤º -->
            <p class="event-subtitle">æœŸé–“: {{ event.start_date.strftime('%m/%d') }} ã€œ {{ event.end_date.strftime('%m/%d') }}</p>
            <div class="event-meta">
                <span>
                    <img src="{{ url_for('static', filename='images/clock-two-svgrepo-com.svg') }}" class="event-meta-icon" alt="æ®‹ã‚ŠæœŸé–“">
                    æ®‹ã‚Šæ—¥æ•°: {{ event.remaining_days }}æ—¥
                </span>
                <!-- <span>ğŸ”¥ æŠ•ç¨¿æ•° 142ä»¶</span> -->
            </div>
        </div>
        <div class="event-action">
            <a href="{{ url_for('event_detail', event_id=event.event_id) }}" class="join-btn">JOIN US</a>
        </div>
    </div>
{% else %}
    <!-- ã‚¤ãƒ™ãƒ³ãƒˆãŒãªã„å ´åˆã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¡¨ç¤º -->
    <div class="event-banner fallback">
        <div class="event-content">
            <h2>æ¬¡å›ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’ãƒã‚§ãƒƒã‚¯ï¼</h2>
            <p class="event-subtitle">ç¾åœ¨é–‹å‚¬ä¸­ã®ã‚¤ãƒ™ãƒ³ãƒˆã¯ã‚ã‚Šã¾ã›ã‚“ãŒã€éå»ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç¢ºèªã§ãã¾ã™ã€‚</p>
        </div>
        <div class="event-action">
            <a href="{{ url_for('events') }}" class="join-btn">ã‚¤ãƒ™ãƒ³ãƒˆä¸€è¦§ã¸</a>
        </div>
    </div>
{% endif %}

<!-- Action Cards -->
<div class="action-cards-container">
    <!-- Post Idea -->
    <a href="{{ url_for('form') }}" class="action-card post-card">
        <div class="card-icon-wrapper">
            <img src="{{ url_for('static', filename='images/edit-1479-svgrepo-com.svg') }}" class="card-icon-svg" alt="æŠ•ç¨¿">
        </div>
        <div class="card-text">
            <h3>æ–°ã—ã„ã‚¢ã‚¤ãƒ‡ã‚¢ã‚’æŠ•ç¨¿</h3>
            <p>ã‚ãªãŸã®ã²ã‚‰ã‚ãã‚’å…±æœ‰ã—ã‚ˆã†</p>
        </div>
    </a>

    <!-- Gacha -->
    <a href="{{ url_for('gacha') }}" class="action-card gacha-card">
        <div class="card-icon-wrapper">
            <img src="{{ url_for('static', filename='images/die-5-svgrepo-com.svg') }}" class="card-icon-svg" alt="ã‚¬ãƒãƒ£">
        </div>
        <div class="card-text">
            <h3>ã‚¢ã‚¤ãƒ‡ã‚¢ã‚¬ãƒãƒ£ã‚’å›ã™</h3>
            <p>ä»–äººã®ã‚¢ã‚¤ãƒ‡ã‚¢ã«ä¾¿ä¹—ã—ã‚ˆã†ï¼</p>
        </div>
    </a>

    <!-- Fusion -->
    <a href="{{ url_for('fusion') }}" class="action-card fusion-card">
        <div class="card-icon-wrapper">
            <img src="{{ url_for('static', filename='images/fusion.svg') }}" class="card-icon-svg" alt="èåˆ">
        </div>
        <div class="card-text">
            <h3>ã‚¢ã‚¤ãƒ‡ã‚¢ã‚’èåˆ</h3>
            <p>è¤‡æ•°ã®ã‚¢ã‚¤ãƒ‡ã‚¢ã‚’AIã§èåˆã—ã‚ˆã†</p>
        </div>
    </a>

    <!-- MyPage -->
    <a href="{{ url_for('mypage') }}" class="action-card mypage-card">
        <div class="card-icon-wrapper">
            <img src="{{ url_for('static', filename='images/user-svgrepo-com.svg') }}" class="card-icon-svg" alt="ãƒã‚¤ãƒšãƒ¼ã‚¸">
        </div>
        <div class="card-text">
            <h3>ãƒã‚¤ãƒšãƒ¼ã‚¸</h3>
            <p>ã‚ãªãŸã®æŠ•ç¨¿ã‚„å±¥æ­´ã‚’ç¢ºèª</p>
        </div>
    </a>
</div>

<!-- Rankings (Timeline Replacement) -->
<section class="ranking-section">
    <div class="section-header">
        <h3 class="section-title">
            <img src="{{ url_for('static', filename='images/trophy-svgrepo-com.svg') }}" class="section-title-icon" alt="ãƒ©ãƒ³ã‚­ãƒ³ã‚°">
            ãƒ©ãƒ³ã‚­ãƒ³ã‚°
        </h3>
    </div>

    <!-- Ranking Tabs -->
    <div class="ranking-tabs">
        <button class="ranking-tab {% if current_period == 'all' %}active{% endif %}" data-period="all">ç·åˆ</button>
        <button class="ranking-tab {% if current_period == 'yearly' %}active{% endif %}" data-period="yearly">å¹´é–“</button>
        <button class="ranking-tab {% if current_period == 'monthly' %}active{% endif %}" data-period="monthly">æœˆé–“</button>
        <button class="ranking-tab {% if current_period == 'weekly' %}active{% endif %}" data-period="weekly">é€±é–“</button>
    </div>

    <!-- Ranking Lists for each period -->
    {% for period_key, period_name in [('all', 'ç·åˆ'), ('yearly', 'å¹´é–“'), ('monthly', 'æœˆé–“'), ('weekly', 'é€±é–“')] %}
    <div class="ranking-list ranking-period-content" data-period="{{ period_key }}" {% if current_period != period_key %}style="display: none;"{% else %}style="display: flex;"{% endif %}>
        {% set period_rankings = rankings_by_period[period_key] %}
        {% if period_rankings %}
            {% for user in period_rankings[:3] %}
            <div class="ranking-item">
                <div class="rank-number {% if user.rank == 1 %}rank-gold{% elif user.rank == 2 %}rank-silver{% elif user.rank == 3 %}rank-bronze{% endif %}">
                    {{ user.rank }}
                </div>
                <div class="rank-user-info">
                    {% if user.icon_path %}
                        {% if user.icon_path.startswith('http') %}
                            <img src="{{ user.icon_path }}" alt="{{ user.nickname }}" class="rank-avatar">
                        {% else %}
                            {% if user.icon_path.startswith('uploads/') %}
                                <img src="{{ url_for('uploaded_file', filename=user.icon_path[8:]) }}" alt="{{ user.nickname }}" class="rank-avatar">
                            {% else %}
                                <img src="{{ url_for('static', filename=user.icon_path) }}" alt="{{ user.nickname }}" class="rank-avatar">
                            {% endif %}
                        {% endif %}
                    {% else %}
                        <div class="rank-avatar-placeholder">
                            {{ user.nickname[0] }}
                        </div>
                    {% endif %}
                    <div class="rank-details">
                        <div class="rank-name">{{ user.nickname }}</div>
                    </div>
                </div>
                <div class="rank-score">
                    <div class="score-value">{{ user.post_count }}</div>
                    <div class="score-label">æŠ•ç¨¿</div>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <p style="text-align: center; color: #999; padding: 1rem;">ã¾ã ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>
        {% endif %}
    </div>
    {% endfor %}
</section>
{% endblock %}

{% block extra_scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const tabs = document.querySelectorAll('.ranking-tab');
    const contents = document.querySelectorAll('.ranking-period-content');
    
    tabs.forEach(tab => {
        tab.addEventListener('click', function() {
            const period = this.getAttribute('data-period');
            
            // ã‚¿ãƒ–ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã‚’æ›´æ–°
            tabs.forEach(t => t.classList.remove('active'));
            this.classList.add('active');
            
            // ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®è¡¨ç¤º/éè¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆ
            contents.forEach(content => {
                if (content.getAttribute('data-period') === period) {
                    content.style.display = 'flex';
                } else {
                    content.style.display = 'none';
                }
            });
            
            // URLã‚’æ›´æ–°ï¼ˆãƒšãƒ¼ã‚¸ãƒªãƒ­ãƒ¼ãƒ‰ãªã—ï¼‰
            const url = new URL(window.location);
            url.searchParams.set('period', period);
            window.history.pushState({}, '', url);
        });
    });
});
</script>
{% endblock %}
