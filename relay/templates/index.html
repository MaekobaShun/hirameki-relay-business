<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã²ã‚‰ã‚ããƒªãƒ¬ãƒ¼ - ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='dashboard.css') }}">
    <!-- å…±é€šã®ã‚¢ã‚¤ã‚³ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«ãªã©ã®ãŸã‚ã«hub.cssã‚‚èª­ã¿è¾¼ã‚€ã‹ã€dashboard.cssã«çµ±åˆã™ã‚‹ã‹ã€‚ä¸€æ—¦dashboard.cssã®ã¿ã§æ§‹ç¯‰ -->
</head>

<body>
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <div class="logo-icon">ğŸ’¡</div>
            <h2 class="logo-text">ã²ã‚‰ã‚ããƒªãƒ¬ãƒ¼</h2>
        </div>
        <nav class="sidebar-nav">
            <a href="{{ url_for('index') }}" class="nav-item active">
                <span class="nav-icon">ğŸ </span>
                <span>ãƒ›ãƒ¼ãƒ </span>
            </a>
            <a href="{{ url_for('form') }}" class="nav-item">
                <span class="nav-icon">âœï¸</span>
                <span>æŠ•ç¨¿ã™ã‚‹</span>
            </a>
            <a href="{{ url_for('gacha') }}" class="nav-item">
                <span class="nav-icon">ğŸ²</span>
                <span>ãƒ”ãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚¬ãƒãƒ£</span>
            </a>
            <!--
            <a href="#" class="nav-item disabled">
                <span class="nav-icon">ğŸ“Š</span>
                <span>åˆ†æãƒ¬ãƒãƒ¼ãƒˆ</span>
            </a>
            <a href="#" class="nav-item disabled">
                <span class="nav-icon">âš™ï¸</span>
                <span>è¨­å®š</span>
            </a>
            -->
        </nav>
    </aside>

    <!-- Main Wrapper -->
    <div class="main-wrapper">
        <!-- Header -->
        <header class="dashboard-header header">
            <div class="search-bar">
                <span class="search-icon">ğŸ”</span>
                <input type="text" class="search-input" placeholder="ã‚¢ã‚¤ãƒ‡ã‚¢ã‚„éƒ¨ç½²ã‚’æ¤œç´¢...">
            </div>
            <div class="header-actions">
                <!-- é€šçŸ¥æ©Ÿèƒ½ -->
                <button class="notification-btn" id="notification-bell">
                    ğŸ””
                    {% if revival_notifications and revival_notifications|length > 0 %}
                    <span class="notification-badge">{{ revival_notifications|length }}</span>
                    {% endif %}
                </button>
                <a href="{{ url_for('mypage') }}" class="user-profile">
                    <!-- ã‚¢ã‚¤ã‚³ãƒ³ãŒã‚ã‚Œã°è¡¨ç¤ºã€ãªã‘ã‚Œã°ã‚¤ãƒ‹ã‚·ãƒ£ãƒ« -->
                    <!-- ã‚¢ã‚¤ã‚³ãƒ³ã®ãƒ‘ã‚¹è§£æ±ºã¯ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã§è¡Œã†ã‹ã€ã“ã“ã§ãƒ­ã‚¸ãƒƒã‚¯ã‚’å…¥ã‚Œã‚‹ -->
                    {% if session.get('icon_path') %}
                        {% if session['icon_path'].startswith('http') %}
                            <img src="{{ session['icon_path'] }}" alt="{{ user_name }}" class="user-avatar">
                        {% else %}
                            <img src="{{ url_for('uploaded_file', filename=session['icon_path'].split('/')[-1]) }}" alt="{{ user_name }}" class="user-avatar">
                        {% endif %}
                    {% else %}
                        <div class="user-avatar-placeholder">
                            {{ user_name[0] }}
                        </div>
                    {% endif %}
                    <span class="user-name">{{ user_name }}</span>
                </a>
            </div>
        </header>

        <!-- Dashboard Content -->
        <main class="dashboard-content">
            <!-- Event Banner -->
            {% if active_events %}
                {% set event = active_events[0] %}
                <div class="event-banner">
                    <div class="event-content">
                        <div class="event-status-badge">ğŸ† ç¾åœ¨é–‹å‚¬ä¸­</div>
                        <h2>{{ event.name }}</h2>
                        <!-- è©³ç´°æƒ…å ±ãŒã‚ã‚Œã°ã“ã“ã«è¡¨ç¤º -->
                        <p class="event-subtitle">æœŸé–“: {{ event.start_date.strftime('%m/%d') }} ã€œ {{ event.end_date.strftime('%m/%d') }}</p>
                        <div class="event-meta">
                            <!-- æ®‹ã‚Šæ—¥æ•°ã‚’è¨ˆç®—ã—ã¦ã‚‚ã‚ˆã„ -->
                            <span>ğŸ•’ æ®‹ã‚Šæ—¥æ•°: {{ (event.end_date - event.start_date).days }}æ—¥</span>
                            <!-- <span>ğŸ”¥ æŠ•ç¨¿æ•° 142ä»¶</span> -->
                        </div>
                    </div>
                    <div class="event-action">
                        <a href="{{ url_for('event_detail', event_id=event.event_id) }}" class="join-btn">JOIN US</a>
                    </div>
                </div>
            {% else %}
                <!-- ã‚¤ãƒ™ãƒ³ãƒˆãŒãªã„å ´åˆã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¡¨ç¤º -->
                <div class="event-banner fallback">
                    <div class="event-content">
                        <h2>æ¬¡å›ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’ãƒã‚§ãƒƒã‚¯ï¼</h2>
                        <p class="event-subtitle">ç¾åœ¨é–‹å‚¬ä¸­ã®ã‚¤ãƒ™ãƒ³ãƒˆã¯ã‚ã‚Šã¾ã›ã‚“ãŒã€éå»ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç¢ºèªã§ãã¾ã™ã€‚</p>
                    </div>
                    <div class="event-action">
                        <a href="{{ url_for('events') }}" class="join-btn">ã‚¤ãƒ™ãƒ³ãƒˆä¸€è¦§ã¸</a>
                    </div>
                </div>
            {% endif %}

            <!-- Action Cards -->
            <div class="action-cards-container">
                <!-- Post Idea -->
                <a href="{{ url_for('form') }}" class="action-card post-card">
                    <div class="card-icon-wrapper">
                        âœï¸
                    </div>
                    <div class="card-text">
                        <h3>æ–°ã—ã„ã‚¢ã‚¤ãƒ‡ã‚¢ã‚’æŠ•ç¨¿</h3>
                        <p>ã‚ãªãŸã®ã²ã‚‰ã‚ãã‚’å…±æœ‰ã—ã‚ˆã†</p>
                    </div>
                </a>

                <!-- Gacha -->
                <a href="{{ url_for('gacha') }}" class="action-card gacha-card">
                    <div class="card-icon-wrapper">
                        ğŸ²
                    </div>
                    <div class="card-text">
                        <h3>ã‚¢ã‚¤ãƒ‡ã‚¢ã‚¬ãƒãƒ£ã‚’å›ã™</h3>
                        <p>ä»–äººã®ã‚¢ã‚¤ãƒ‡ã‚¢ã«ä¾¿ä¹—ã—ã‚ˆã†ï¼</p>
                    </div>
                </a>
            </div>

            <!-- Rankings (Timeline Replacement) -->
            <section class="ranking-section">
                <div class="section-header">
                    <h3 class="section-title">ğŸ“ˆ ãƒ©ãƒ³ã‚­ãƒ³ã‚°</h3>
                </div>

                <div class="ranking-list">
                    {% if rankings %}
                        {% for user in rankings %}
                        <div class="ranking-item">
                            <div class="rank-number {% if user.rank <= 3 %}top-rank{% endif %}">
                                {% if user.rank == 1 %}ğŸ¥‡{% elif user.rank == 2 %}ğŸ¥ˆ{% elif user.rank == 3 %}ğŸ¥‰{% else %}{{ user.rank }}{% endif %}
                            </div>
                            <div class="rank-user-info">
                                {% if user.icon_path %}
                                    {% if user.icon_path.startswith('http') %}
                                        <img src="{{ user.icon_path }}" alt="{{ user.nickname }}" class="rank-avatar">
                                    {% else %}
                                        <!-- uploads/ prefix handling logic same as ranking.html -->
                                        {% if user.icon_path.startswith('uploads/') %}
                                            <img src="{{ url_for('uploaded_file', filename=user.icon_path[8:]) }}" alt="{{ user.nickname }}" class="rank-avatar">
                                        {% else %}
                                            <img src="{{ url_for('static', filename=user.icon_path) }}" alt="{{ user.nickname }}" class="rank-avatar">
                                        {% endif %}
                                    {% endif %}
                                {% else %}
                                    <div class="rank-avatar-placeholder">
                                        {{ user.nickname[0] }}
                                    </div>
                                {% endif %}
                                <div class="rank-details">
                                    <div class="rank-name">{{ user.nickname }}</div>
                                    <!-- <div class="rank-id">@{{ user.user_id }}</div> -->
                                </div>
                            </div>
                            <div class="rank-score">
                                <div class="score-value">{{ user.post_count }}</div>
                                <div class="score-label">æŠ•ç¨¿</div>
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                        <p style="text-align: center; color: #999; padding: 1rem;">ã¾ã ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>
                    {% endif %}
                </div>
            </section>

        </main>
    </div>

    {% include 'notification_panel.html' %}
    <script src="{{ url_for('static', filename='header.js') }}" defer></script>
</body>

</html>