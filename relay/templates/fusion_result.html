{% extends "base.html" %}

{% block title %}èåˆçµæœ - ã²ã‚‰ã‚ããƒªãƒ¬ãƒ¼{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='fusion.css') }}">
{% endblock %}

{% block header_intro %}
<p class="header-eyebrow">FUSION RESULT</p>
<h1 class="header-title">èåˆçµæœ</h1>
{% endblock %}

{% block content %}
<div class="fusion-result-main">
    <section class="fusion-result-wrapper">
        <h2 class="fusion-result-title">âœ¨ èåˆå®Œäº†ï¼</h2>

        {% with messages = get_flashed_messages() %}
        {% if messages %}
        <div class="fusion-result-flash">
            {% for message in messages %}
            <p>{{ message }}</p>
            {% endfor %}
        </div>
        {% endif %}
        {% endwith %}

        {% if fusion_result %}
            <!-- å…ƒã®ã‚¢ã‚¤ãƒ‡ã‚¢è¡¨ç¤º -->
            <div class="parent-ideas-section">
                <h3 class="section-title">èåˆã—ãŸã‚¢ã‚¤ãƒ‡ã‚¢</h3>
                <div class="parent-ideas-grid">
                    {% for parent_idea in fusion_result.parent_ideas %}
                    <div class="parent-idea-card">
                        <div class="parent-idea-header">
                            <span class="parent-idea-category">{{ parent_idea.category }}</span>
                        </div>
                        <h4 class="parent-idea-title">{{ parent_idea.title }}</h4>
                        <p class="parent-idea-detail">{{ parent_idea.detail[:150] }}{% if parent_idea.detail|length > 150 %}...{% endif %}</p>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- èåˆçµæœè¡¨ç¤º -->
            <div class="fused-idea-section">
                <h3 class="section-title">èåˆã•ã‚ŒãŸã‚¢ã‚¤ãƒ‡ã‚¢</h3>
                {% if fusion_result.fused_idea %}
                    <!-- æ—¢ã«æŠ•ç¨¿ã•ã‚Œã¦ã„ã‚‹å ´åˆ -->
                    <article class="fused-idea-card">
                        <h4 class="fused-idea-title">{{ fusion_result.fused_idea.title }}</h4>
                        <p class="fused-idea-detail">{{ fusion_result.fused_idea.detail | replace('\n', '<br>') | safe }}</p>
                        <span class="fused-idea-category">ğŸ“ {{ fusion_result.fused_idea.category }}</span>
                        <div class="fused-idea-actions">
                            <a href="{{ url_for('post_view', idea_id=fusion_result.fused_idea.idea_id) }}" class="fused-idea-link">æŠ•ç¨¿ã‚’ç¢ºèª</a>
                        </div>
                    </article>
                {% elif fusion_result.fused_title %}
                    <!-- æ–°è¦èåˆçµæœã®å ´åˆ -->
                    <article class="fused-idea-card">
                        <h4 class="fused-idea-title">{{ fusion_result.fused_title }}</h4>
                        <p class="fused-idea-detail">{{ fusion_result.fused_detail | replace('\n', '<br>') | safe }}</p>
                        <span class="fused-idea-category">ğŸ“ {{ fusion_result.fused_category }}</span>
                        
                        <!-- æŠ•ç¨¿ãƒ•ã‚©ãƒ¼ãƒ  -->
                        <form action="{{ url_for('fusion_post') }}" method="post" class="fusion-post-form">
                            <input type="hidden" name="fusion_id" value="{{ fusion_id }}">
                            <input type="hidden" name="title" value="{{ fusion_result.fused_title }}">
                            <input type="hidden" name="detail" value="{{ fusion_result.fused_detail }}">
                            <input type="hidden" name="category" value="{{ fusion_result.fused_category }}">
                            <button type="submit" class="fusion-post-button">ã“ã®ã‚¢ã‚¤ãƒ‡ã‚¢ã‚’æŠ•ç¨¿ã™ã‚‹</button>
                        </form>
                    </article>
                {% endif %}
            </div>
        {% else %}
            <div class="fusion-result-empty">
                <p>èåˆçµæœãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</p>
            </div>
        {% endif %}

        <div class="fusion-result-actions">
            <a href="{{ url_for('fusion') }}" class="fusion-result-button secondary">ã‚‚ã†ä¸€åº¦èåˆã™ã‚‹</a>
            <a href="{{ url_for('index') }}" class="fusion-result-button">ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹</a>
        </div>
    </section>
</div>
{% endblock %}

