{% extends "base.html" %}

{% block title %}ã²ã‚‰ã‚ãã‚¬ãƒãƒ£ - ã²ã‚‰ã‚ããƒªãƒ¬ãƒ¼{% endblock %}

{% block header_intro %}
<p class="header-eyebrow">GACHA</p>
<h1 class="header-title">ã²ã‚‰ã‚ãã‚¬ãƒãƒ£</h1>
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='gacha.css') }}">
{% endblock %}

{% block extra_scripts %}
<script>
    // ãƒã‚±ãƒƒãƒˆæ•°ã‚’æ›´æ–°ã™ã‚‹é–¢æ•°
    function updateTicketCount(newCount) {
        const ticketCountEl = document.getElementById('ticket-count');
        const spinButton = document.getElementById('spin-button');
        if (ticketCountEl) {
            ticketCountEl.textContent = newCount;
        }
        if (spinButton) {
            spinButton.disabled = newCount < 1;
        }
    }
    
    // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã«ãƒã‚±ãƒƒãƒˆæ•°ã‚’ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰å–å¾—ã—ãŸå€¤ã‚’ä½¿ç”¨
    window.addEventListener('load', function() {
        // ãƒã‚±ãƒƒãƒˆæ•°ã¯ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰æ¸¡ã•ã‚ŒãŸå€¤ã‚’ä½¿ç”¨
        const currentTickets = {{ ticket_count }};
        updateTicketCount(currentTickets);
    });
</script>
{% endblock %}

{% block content %}
<div class="gacha-main">
    <section class="gacha-card">
        <div class="gacha-icon">ğŸ’¡</div>
        <h2 class="gacha-title">ã²ã‚‰ã‚ãã‚¬ãƒãƒ£</h2>
        <p class="gacha-description">
            <strong>æ¬¡ã®ã‚¢ã‚¤ãƒ‡ã‚¢ã¯ã€ã“ã“ã‹ã‚‰ã¯ã˜ã¾ã‚‹ã€‚</strong>
        </p>
        <div class="gacha-ticket-display">
            <span class="ticket-label">ğŸ« ã‚¬ãƒãƒ£ãƒã‚±ãƒƒãƒˆ</span>
            <span class="ticket-count" id="ticket-count">{{ ticket_count }}</span>
            <span class="ticket-unit">æš</span>
        </div>
        
        <form action="{{ url_for('spin') }}" method="get">
            {% set category_options = [
                {'value': '', 'label': 'ã™ã¹ã¦', 'description': 'ã™ã¹ã¦ã®ã‚«ãƒ†ã‚´ãƒªã‹ã‚‰', 'icon': 'ğŸŒˆ'},
                {'value': 'ãƒ“ã‚¸ãƒã‚¹ãƒ»æ¥­å‹™åŠ¹ç‡åŒ–', 'label': 'ãƒ“ã‚¸ãƒã‚¹ãƒ»æ¥­å‹™åŠ¹ç‡åŒ–', 'description': 'æ¥­å‹™æ”¹å–„ãƒ»è‡ªå‹•åŒ–ã‚¢ã‚¤ãƒ‡ã‚¢', 'icon': 'ğŸ“ˆ'},
                {'value': 'æ•™è‚²', 'label': 'æ•™è‚²', 'description': 'å­¦ã³ã‚’ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ', 'icon': 'ğŸ“'},
                {'value': 'ã‚¨ãƒ³ã‚¿ãƒ¡', 'label': 'ã‚¨ãƒ³ã‚¿ãƒ¡', 'description': 'ãƒ¯ã‚¯ãƒ¯ã‚¯ã‚’ç”Ÿã‚€ç™ºæƒ³', 'icon': 'ğŸ‰'},
                {'value': 'ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–ãƒ»å‰µä½œæ”¯æ´', 'label': 'ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–ãƒ»å‰µä½œæ”¯æ´', 'description': 'ã‚‚ã®ã¥ãã‚Šã‚’åŠ é€Ÿ', 'icon': 'ğŸ¨'},
                {'value': 'ç”Ÿæ´»ãƒ»ãƒ©ã‚¤ãƒ•ã‚¹ã‚¿ã‚¤ãƒ«', 'label': 'ç”Ÿæ´»ãƒ»ãƒ©ã‚¤ãƒ•ã‚¹ã‚¿ã‚¤ãƒ«', 'description': 'æš®ã‚‰ã—ã‚’è±Šã‹ã«', 'icon': 'ğŸ¡'},
                {'value': 'ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³', 'label': 'ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³', 'description': 'ã¤ãªãŒã‚Šã‚’æ·±ã‚ã‚‹', 'icon': 'ğŸ’¬'},
                {'value': 'é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«', 'label': 'é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«', 'description': 'é–‹ç™ºã‚’ã‚‚ã£ã¨ã‚¹ãƒãƒ¼ãƒˆã«', 'icon': 'ğŸ› ï¸'},
                {'value': 'ãã®ä»–', 'label': 'ãã®ä»–', 'description': 'æ ã«åã¾ã‚‰ãªã„ã‚¢ã‚¤ãƒ‡ã‚¢', 'icon': 'âœ¨'}
            ] %}
            {% set selected_value = selected_category or '' %}
            <div class="category-section">
                <p id="category-label" class="category-heading">ã‚«ãƒ†ã‚´ãƒªã‚’é¸æŠ</p>
                <div class="category-selector" role="radiogroup" aria-labelledby="category-label">
                    {% for option in category_options %}
                        {% set option_id = 'category-' ~ loop.index %}
                        <div class="category-item">
                            <input
                                type="radio"
                                name="category"
                                id="{{ option_id }}"
                                value="{{ option.value }}"
                                class="category-input"
                                {% if selected_value == option.value %}checked{% endif %}
                            >
                            <label for="{{ option_id }}" class="category-option">
                                <span class="category-header">
                                    <span class="category-icon" aria-hidden="true">{{ option.icon }}</span>
                                    <span class="category-name">{{ option.label }}</span>
                                </span>
                                <span class="category-description">{{ option.description }}</span>
                            </label>
                        </div>
                    {% endfor %}
                </div>
            </div>
            <button type="submit" class="spin-button" id="spin-button" {% if ticket_count < 1 %}disabled{% endif %}>
                ã‚¬ãƒãƒ£ã‚’å›ã™
            </button>
        </form>

        <a href="{{ url_for('index') }}" class="link-secondary">ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹</a>
    </section>
</div>
{% endblock %}
