<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}„Å≤„Çâ„ÇÅ„Åç„É™„É¨„Éº{% endblock %}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='common.css') }}">
    {% block extra_css %}{% endblock %}
</head>

<body>
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <div class="logo-icon">üí°</div>
            <h2 class="logo-text">„Å≤„Çâ„ÇÅ„Åç„É™„É¨„Éº</h2>
        </div>
        <nav class="sidebar-nav">
            <a href="{{ url_for('index') }}" class="nav-item {% if request.endpoint == 'index' %}active{% endif %}">
                <img src="{{ url_for('static', filename='images/home-svgrepo-com.svg') }}" class="nav-icon-svg" alt="„Éõ„Éº„É†">
                <span>„Éõ„Éº„É†</span>
            </a>
            <a href="{{ url_for('form') }}" class="nav-item {% if request.endpoint == 'form' %}active{% endif %}">
                <img src="{{ url_for('static', filename='images/edit-1479-svgrepo-com.svg') }}" class="nav-icon-svg" alt="ÊäïÁ®ø">
                <span>ÊäïÁ®ø„Åô„Çã</span>
            </a>
            <a href="{{ url_for('gacha') }}" class="nav-item {% if request.endpoint == 'gacha' %}active{% endif %}">
                <img src="{{ url_for('static', filename='images/die-5-svgrepo-com.svg') }}" class="nav-icon-svg" alt="„Ç¨„ÉÅ„É£">
                <span>„Ç¨„ÉÅ„É£</span>
            </a>
            <a href="{{ url_for('ranking') }}" class="nav-item {% if request.endpoint == 'ranking' %}active{% endif %}">
                <img src="{{ url_for('static', filename='images/ranking-1-svgrepo-com.svg') }}" class="nav-icon-svg" alt="„É©„É≥„Ç≠„É≥„Ç∞">
                <span>„É©„É≥„Ç≠„É≥„Ç∞</span>
            </a>
            <a href="{{ url_for('events') }}" class="nav-item {% if request.endpoint == 'events' %}active{% endif %}">
                <img src="{{ url_for('static', filename='images/event-svgrepo-com.svg') }}" class="nav-icon-svg" alt="„Ç§„Éô„É≥„Éà">
                <span>„Ç§„Éô„É≥„Éà</span>
            </a>
             <a href="{{ url_for('mypage') }}" class="nav-item {% if request.endpoint == 'mypage' %}active{% endif %}">
                <img src="{{ url_for('static', filename='images/user-svgrepo-com.svg') }}" class="nav-icon-svg" alt="„Éû„Ç§„Éö„Éº„Ç∏">
                <span>„Éû„Ç§„Éö„Éº„Ç∏</span>
            </a>
            <!--
            <a href="#" class="nav-item disabled">
                <span class="nav-icon">‚öôÔ∏è</span>
                <span>Ë®≠ÂÆö</span>
            </a>
            -->
        </nav>
    </aside>

    <!-- Main Wrapper -->
    <div class="main-wrapper">
        <!-- Header -->
        <header class="dashboard-header header">
            <div class="header-intro">
                {% block header_intro %}
                {% endblock %}
            </div>
            <div class="header-actions">
                <!-- ÈÄöÁü•Ê©üËÉΩ -->
                <button class="notification-btn" id="notification-bell">
                    <img src="{{ url_for('static', filename='images/bell-svgrepo-com.svg') }}" class="notification-icon-svg" alt="ÈÄöÁü•">
                    {% if revival_notifications and revival_notifications|length > 0 %}
                    <span class="notification-badge">{{ revival_notifications|length }}</span>
                    {% endif %}
                </button>
                <a href="{{ url_for('mypage') }}" class="user-profile">
                    <!-- „Ç¢„Ç§„Ç≥„É≥„Åå„ÅÇ„Çå„Å∞Ë°®Á§∫„ÄÅ„Å™„Åë„Çå„Å∞„Ç§„Éã„Ç∑„É£„É´ -->
                    {% if session.get('icon_path') %}
                        {% if session['icon_path'].startswith('http') %}
                            <img src="{{ session['icon_path'] }}" alt="{{ session.get('nickname', 'User') }}" class="user-avatar">
                        {% else %}
                            <img src="{{ url_for('uploaded_file', filename=session['icon_path'].split('/')[-1]) }}" alt="{{ session.get('nickname', 'User') }}" class="user-avatar">
                        {% endif %}
                    {% else %}
                        <div class="user-avatar-placeholder">
                            {{ session.get('nickname', 'U')[0] }}
                        </div>
                    {% endif %}
                    <span class="user-name">{{ session.get('nickname', 'Guest') }}</span>
                </a>
            </div>
        </header>

        <!-- Content -->
        <main class="dashboard-content">
            {% with messages = get_flashed_messages() %}
            {% if messages %}
            <div class="flash-messages" style="margin-bottom: 2rem; padding: 1rem; background: #fee2e2; color: #b91c1c; border-radius: 0.5rem;">
                {% for message in messages %}
                <p>{{ message }}</p>
                {% endfor %}
            </div>
            {% endif %}
            {% endwith %}

            {% block content %}{% endblock %}
        </main>
    </div>

    {% include 'notification_panel.html' %}
    <script src="{{ url_for('static', filename='header.js') }}" defer></script>
    {% block extra_scripts %}{% endblock %}
</body>

</html>