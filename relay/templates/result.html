<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ã‚¬ãƒãƒ£çµæœ - ã²ã‚‰ã‚ããƒªãƒ¬ãƒ¼</title>
        <link rel="stylesheet" href="{{ url_for('static', filename='hub.css') }}">
        <link rel="stylesheet" href="{{ url_for('static', filename='result.css') }}">
        <link rel="stylesheet" href="{{ url_for('static', filename='gacha.css') }}">
        <script src="{{ url_for('static', filename='header.js') }}" defer></script>
        <script>
            // ãƒã‚±ãƒƒãƒˆæ•°ã‚’æ›´æ–°ã™ã‚‹é–¢æ•°
            function updateTicketCount(newCount) {
                const ticketCountEl = document.getElementById('ticket-count');
                const spinAgainButton = document.getElementById('spin-again-button');
                if (ticketCountEl) {
                    ticketCountEl.textContent = newCount;
                }
                if (spinAgainButton) {
                    spinAgainButton.disabled = newCount < 1;
                }
            }
            
            // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã«ãƒã‚±ãƒƒãƒˆæ•°ã‚’æ›´æ–°
            window.addEventListener('load', function() {
                const currentTickets = {{ tickets }};
                updateTicketCount(currentTickets);
            });
        </script>
    </head>
    <body>
        <header class="header">
            <div class="header-content">
                <div class="header-left">
                    <div class="logo-icon">ğŸ’¡</div>
                    <h1 class="logo-text">ã²ã‚‰ã‚ããƒªãƒ¬ãƒ¼</h1>
                </div>
                <div class="header-right">
                    <button class="menu-toggle" type="button" aria-label="ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‹ã" aria-expanded="false">
                        <span></span>
                        <span></span>
                        <span></span>
                    </button>
                    <nav class="mypage-nav">
                        <a href="{{ url_for('index') }}">ãƒ›ãƒ¼ãƒ </a>
                        <a href="{{ url_for('form') }}">æŠ•ç¨¿</a>
                        <a href="{{ url_for('gacha') }}" class="active">ã‚¬ãƒãƒ£</a>
                        <a href="{{ url_for('mypage') }}">ãƒã‚¤ãƒšãƒ¼ã‚¸</a>
                    </nav>
                </div>
            </div>
        </header>

        <main class="result-main">
            <section class="result-wrapper">
                <div class="result-icon">ğŸ‰</div>
                <h2 class="result-title">ã‚¬ãƒãƒ£çµæœ</h2>
                <div class="ticket-display">
                    <span class="ticket-label">ğŸ« ã‚¬ãƒãƒ£ãƒã‚±ãƒƒãƒˆ</span>
                    <span class="ticket-count" id="ticket-count">{{ tickets }}</span>
                    <span class="ticket-unit">æš</span>
                </div>

                {% with messages = get_flashed_messages() %}
                    {% if messages %}
                        <div class="result-flash">
                            {% for message in messages %}
                                <p>{{ message }}</p>
                            {% endfor %}
                        </div>
                    {% endif %}
                {% endwith %}

                {% if item %}
                    <article class="result-card">
                        <h3 class="result-card__title">{{ item[1] }}</h3>
                        <p class="result-card__detail">{{ item[2] }}</p>
                        <span class="result-card__category">ğŸ“ {{ item[3] }}</span>
                    </article>
                {% else %}
                    <div class="result-card">
                        <p class="result-empty">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>
                    </div>
                {% endif %}

                <div class="result-actions">
                    <form action="{{ url_for('spin') }}" method="get" class="result-action-form">
                        {% if request.args.get('category') %}
                            <input type="hidden" name="category" value="{{ request.args.get('category') }}">
                        {% endif %}
                        <button type="submit" class="result-button secondary" id="spin-again-button" {% if tickets < 1 %}disabled{% endif %}>ã‚‚ã†ä¸€åº¦å›ã™</button>
                    </form>
                    <a href="{{ url_for('gacha') }}" class="result-button">ã‚«ãƒ†ã‚´ãƒªé¸æŠç”»é¢ã«æˆ»ã‚‹</a>
                </div>
            </section>
        </main>

        <div class="floating-sparkle sparkle-1">âœ¨</div>
        <div class="floating-sparkle sparkle-2">âœ¨</div>
    </body>
</html>